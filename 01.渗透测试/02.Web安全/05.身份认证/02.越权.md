# 垂直越权

权限校验不充分，导致低权限用户可以访问高权限用户的接口，比如说随便注册一个账户就能访问各种查询接口

```
如何挖掘：
如果有管理员账号和普通用户账号就比较简单，管理操作，然后替换数据包中的鉴权部分为普通用户的
如果只有普通用户的账号，我觉得主要是如何获得敏感接口，一种是通过被动扫描来找到接口文档，另一种是通过从js文件中手动构造或者fuzz接口的名称
```

修复方案

- 进行合理的权限划分。
- 权限最小化原则，限制用户不必要的权限，用户权限过期后应当予以回收。



# 水平越权

普通用户拥有其他平行级别用户的权限

```
比较常见的就是在获取个人信息处通过遍历id获得其他用户的个人信息，还有通过userid，xxid，/user/userid来进行查询

最好的话还是注册两个账户进行测试，这样更好发现参数区别
```

```
越权漏洞和遍历漏洞的区别：
功能点的权限分配不同。越权漏洞产生的功能点是属于特定用户才能使用的，而遍历漏洞产生的功能点是应用本身就需要用到的，只是应用没有做好频率控制和数据拖取限制，导致可以通过遍历某个参数获得大量敏感信息，从而造成危害。
```

修复方案

- 一对一，用户id对应一条数据，比如查看个人信息

  ```
  用户id不应该由用户的传参来决定，应该从session中获取用户id，然后带入数据库中进行查询
  ```

- 一对多，用户id对应多条数据，比如一个用户有多个订单

  表结构在设计之初应考虑订单和用户对应的关系

  | order_id | order_no          | user_id | total_price | pay_status | pay_type | extra_info |
  | -------- | ----------------- | ------- | ----------- | ---------- | -------- | ---------- |
  | 1        | 15688187285093508 | 1       | 2492        | 1          | 2        |            |
  | 2        | 15885800076852966 | 10      | 2245        | 1          | 1        |            |

  可以看到存在其中`order_no`和`user_id`存在对应关系，所以将`orderNo`和从session中获取的`userId`同时查询可解决越权问题。

