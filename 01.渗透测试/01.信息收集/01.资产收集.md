# 为什么

**尽可能的扩大攻击面**



# 主域名收集

## ICP备案查询

- 是什么

  ICP备案是指网站在信息产业部提交网站信息进行官方认可。

  所以国内使用国内服务器的网站，都必须要先办理ICP备案后才可以上线。

- 有什么用

  通过查询目标企业的备案信息，可直接获取到目标企业注册了哪些域名，从而增加可渗透的目标范围。





## WhoIs

- 是什么

  `WHOIS`是用来查询互联网中域名的IP以及所有者等信息的传输协议。

- 有什么用

  通过查询目标的WHOIS信息，可以对联系人、联系邮箱等信息进行反查，可以获取更多相关的域名信息。

  



## 股权信息

通过查询股权信息，或者股权穿透图，寻找子公司和孙公司等，一般对外投资超过50%或者有行政权限的都可以算目标



## DNS共享记录查询

- 原理

  查询共享DNS服务器的主机来获取到相关的域名

- 步骤

  1. 首先查询目标是否存在自建的NS服务器

     ```shell
     nslookup -query=ns baidu.com
     ```

  2. 将非权威应答中的ns服务器带到下面的网站查询

     [Find all Hosts pointing to DNS Server](https://hackertarget.com/find-shared-dns-servers/)




# 子域名收集

### 子域名爆破

- 原理

  通过不断的拼接字典中的子域名前缀去枚举域名的A记录，再对其进行验证，但是该方法一般需要解决泛解析问题。


- 泛解析

  A记录：*.khaz.top → 1.1.1.1 （这样xxx.khaz.top域名在进行dns解析时都会指向1.1.1.1）

  如何解决泛解析：

  ```bash
  # 黑名单IP法
  通过获取一个不存在的子域名相应解析IP，来记录标记黑名单ip，再爆破字典时，解析到的IP在这个黑名单ip中，则跳过，不存在就继续处理。
  # TTL
  在权威 DNS 中，泛解析记录的 TTL 肯定是相同的，如果子域名记录相同，但 TTL 不同，那这条记录可以说肯定不是泛解析记录。
  ```

  > 以oneforall为例：
  >
  > oneforall会首先访问一个随机的并不存在的域，通过返回结果判断是否存在泛解析，确定存在泛解析以后，程序会开始不断的循环产生随机域名，去向服务器查询，将每次查询到的IP和TTL记录下来，直到大部分的IP地址出现次数都大于两次，则IP黑名单的收集结束，在得到了IP黑名单以后，oneforall接下来会将自己的字典中的每一项和要指定查询的域名进行拼接。在爆破过程中根据IP黑名单进行过滤。但这种宽泛的过滤容易导致漏报，所以oneforall将 TTL 也作为黑名单规则的一部分，评判的依据是：在权威 DNS 中，泛解析记录的 TTL 肯定是相同的，如果子域名记录相同，但 TTL 不同，那这条记录可以说肯定不是泛解析记录。



### 证书透明度

- 是什么

  证书透明性（Certificate Transparency，CT）是 Google 的公开项目，通过让域所有者、CA 和域用户对 SSL 证书的发行和存在进行审查，来纠正这些基于证书的威胁。

- 有什么用

  因为是公开的，所以任何人都可以访问到其中的CA 证书，包含了域名、子域名、邮箱等敏感信息。

- 在线查询

  [crt.sh | Certificate Search](https://crt.sh/)

  [Censys Search](https://search.censys.io/)



### DNS公开数据集

利用已有公开的扫描数据集，对子域名信息进行收集。

https://opendata.rapid7.com/



### DNS 域传送

- 是什么

  DNS服务器分为主服务器，备份服务器，缓存服务器。

  **域传送**是指备份服务器从主服务器上复制数据，然后更新自身的数据库，以达到数据同步的目的，这样是为了增加冗余，一旦主服务器出现问题可直接让备份服务器做好支撑工作。

- 有什么用

  若 DNS 服务器配置不当，可能导致攻击者获取某个域的所有记录。造成整个网络的拓扑结构泄露给潜在的攻击者。

- 检测方法

  - dig请求

    ```shell
    # 找到NS服务器
    dig [domain] ns
    # 发送axfr请求
    dig axfr @[ns] [domain]
    ```

  - nmap脚本

    ```shell
    --script dns-zone-transfer --script-args dns-zone-transfer.domain=[domain]
    ```

    

### 搜索引擎

- 传统搜索引擎

  ```
  site: xxx.com -xxx (-xxx 排除哪些子域)
  ```

- 网络空间测绘



### 站点爬虫

通过爬取网站中的url链接来发现新的子域名，通过Burp插件被动收集



### 站点信息泄漏

- crossdomain.xml
- sitemap.xml
- 响应包中的CSP其中*-src可能会存在域名信息




### 第三方在线平台

- https://securitytrails.com（UI好看，结果最多）

- [DNSdumpster.com ](https://dnsdumpster.com/)

- https://rapiddns.io/

  



# 供应链单位

- 范围
  - 开发商、外包商、运维商、硬件提供商
- 获取途径
  - 页面版权所有，谁开发的
  - 对官网等特定系统通过首页或目录扫描的备份文件或模板页面源代码中查找供应商
  - 搜索引擎搜索特定系统名称-招标公告-应标单位
- 攻击方式
  - 供应商示例系统的默认账号
  - 供应商示例系统或该系统的其他使用单位进行漏洞尝试
    - 如目标系统不开放注册但示例和其他公网系统开放注册功能，即可从前台转为后台进行黑盒测试
  - 通过各种途径获取源码后进行代码审计
  - 收集客服信息（人员信息、安全意识、浏览器版本、office版本）、IT管理员信息进行钓鱼





# 行业信息关键字

通过相关关键字进行检索发现资产

## 气象局

系统关键词

```
污染
排污
空气质量
垃圾焚烧
环评
辐射
监测
监控
环境
自然
生态
废物
质量
```

## 教育-教育厅

通过教育厅官网机构设置、直属单位获取组织结构

搜索引擎 site：xxx 直属单位 site：xxx 机构设置

教育考试院（招生考试院）直属于教育厅

### 教育-学校

- 组织架构
  - 学校名下公司
  - 出版社
  - 基金会
  - 校友会
- 网络空间搜索引擎
  - title、body
  - domain
  - cert
  - icon
- 快速突破口：vpn、sso，在信息化门户搜集登录规则
- google语法
  - site:xxx.com "身份证号/学号/工号/vpn" (filetype：xls/doc)
- GitHub
  - "xxx.edu.cn" "username/password/vpn"

## 医疗-卫健委

- 提取关键字
  - 机构-内设机构
  - 委领导-分管工作
- 卫健委前身卫计委、卫生部/卫生厅/卫生局
- 妇幼保健院隶属于于卫健委
- 关键字：卫生健康委、卫生健康、卫计委、卫生和计划生育委员会

## 金融-银行

- 金融官网一般是业务，组织架构参考每年社会责任报告、年报、关于我们-信息披露中存
- 在组织架构
- 网络空间搜索引擎
  - domain
  - cert： cert="China Merchants Bank"/"XX 银行"/"xxx.com"/"xxx"
  - icon
- Web突破点
  - 微信公众号、小程序
  - 移动端APP
  - 未开放系统或测试系统
- google语法
  - site:xxx.com "身份证号"/"工号"/"vpn" (filetype：xls/doc)
  - site:xxx.com inurl:login/inurl:upload
- github语法
  - "xxx.edu.cn" "username/password/vpn"
- 邮箱查找可通过天眼查（收费）

## 政务-政务云

- 可能的突破点

  - 市场监督管理局-特种设备管理

  - 浪潮云表单

  - 集约化

  - 重要景区（可能）

  - 广电局、广播电视局

    - 跟广播电视台不同，行政单位和事业单位的区别

    

# 其他应用中的域名/IP

```
微信/支付宝小程序
微信公众号
手机APP：抓包，历史版本
```

