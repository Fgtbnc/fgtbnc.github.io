---
title: 后渗透之了解
date: 2023/5/1 15:00:25
categories:
- 渗透测试
tags:
- 内网
---



# 目标

内网渗透测试的目标一般是获取特定机器的权限或者特定用户，进而获得特定的资源，对内网的安全性进行评估。



# 本机信息收集

本机信息包括OS、权限、内网IP段、杀软、端口、服务、补丁更新频率、网络连接、共享、会话等。如果是域内主机，OS、应用软件、补丁、服务、杀软这些一般都是批量安装的。



# 判断是否存在域

获得本机相关信息之后，就要判断当前内网中是否存在域。如果当前内网存在域，则需要判断所控主机是否在域内。



# 域内基础信息收集

- 主机
- 用户和用户组
- 计算机列表
- 密码策略
- 域控
- 域管理员
- 域管理进程
- 核心业务机器
- 敏感文件
- 域内网段划分情况及拓扑结构



# 构建隧道

- 判断内网连通性构建相应隧道
- 端口转发



**遵循三个原则**

1. **稳定性**（主要用于扫描）{ 支持高并发、自动断线重连 }
2. **安全性**（防止socks5直接被ban）{ 流量可加密、开放代理可设置认证 }
3. **健壮性** { 支持多种协议方式、最好支持插件定制 }





# 探测域内存活主机

在进行域内存活主机探测的时候，有几个注意点：

- 尽量避免触发域内的一些防病毒软件的告警和拦截；
- 在非授权情况下，避免使用工具进行暴力扫描；
- 尽量避免在目标机子上使用图形化工具；
- 尽量使用系统自带的工具进行探测，如powershell脚本；



# 域内存活主机端口扫描

一般端口扫描需要关注如下三点：

- 端口的Banner信息；
- 端口上运行的服务；
- 常见服务的默认端口号；



# 横向移动 → 拿下域控

为什么要拿下域控呢？

> 活动目录是一种基于Windows的目录服务，用于存储并向内部网络环境提供数据对象。它允许集中管理身份验证和授权。 AD包含有关网络和环境的基本信息，包括用户、计算机、打印机等。例如，AD 可能包含用户的详细信息，如职位、电话号码、地址、密码、组、权限等。
>
> 而要想实现域环境，就必须要计算机中安装活动目录。
>
> 如果说在内网中的一台计算机上安装了活动目录，那它就变成了域控制器。

- Web手段

  ```
  常见Web，主机漏洞
  集权系统：
  exchange
  vencenter
  ```

- 密码喷洒

  ```
  各种收集到的凭证+密码喷洒
  ```

- 域内手法

  - 协议攻击

    ```
    NTLM协议
    Kerberos协议
    ```

    

  

# 辅助

- 免杀

  > 绕过防护软件比如AV，IDS，IPS，EDR

- 权限提升

  > 很多操作都需要高权限才能做

- 权限维持和痕迹清理

  > 攻击过程不是一蹴而就的，需要防止在攻击过程中被发现和查杀，导致攻击失败